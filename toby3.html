<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Analytics Tool Stack</title>
    <style>
        /* --- RESET & GLOBAL FONTS --- */
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Google Sans', 'Google Sans Text', 'Segoe UI', Helvetica, Arial, sans-serif;
        }

        body, html {
            height: 100%;
            overflow: hidden;
            display: flex;
            flex-direction: column; 
        }

        /* --- VIDEO BACKGROUND --- */
        .video-background {
            position: fixed;
            top: 0;
            left: 0;
            width: 100vw;
            height: 100vh;
            z-index: -2;
            background: #002d56;
        }
        
        .video-background iframe {
            position: absolute;
            top: 50%;
            left: 50%;
            width: 100vw;
            height: 56.25vw; 
            min-height: 100vh;
            min-width: 177.77vh;
            transform: translate(-50%, -50%);
            pointer-events: none;
        }

        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: radial-gradient(circle at center, rgba(0, 45, 86, 0.1) 0%, rgba(0, 45, 86, 0.4) 100%);
            z-index: -1;
        }

        /* --- NAVIGATION --- */
        nav {
            display: flex;
            justify-content: flex-start;
            align-items: center;
            padding: 50px 60px; 
            color: white;
            flex-shrink: 0; 
            z-index: 10;
        }

        body.interacting nav { display: none !important; }

        .logo-img {
            height: 130px !important; 
            min-height: 130px !important;
            width: auto !important;
            display: block;
        }

        /* --- MAIN LAYOUT --- */
        .container {
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center; 
            flex-grow: 1; 
            color: white;
            padding: 0 10px;
            max-width: 100%; 
            margin: 0 auto;
            width: 100%;
            transition: all 0.5s ease;
        }

        body.interacting .container {
            flex-direction: row; 
            align-items: flex-start; 
            justify-content: center; 
            padding: 20px 10px;
            gap: 15px;
        }

        h1 {
            font-size: 3.8rem;
            margin-bottom: 15px;
            font-weight: 300;
            text-shadow: 0 2px 10px rgba(0,0,0,0.3);
        }

        p.subtitle {
            font-size: 1.6rem;
            margin-bottom: 20px; 
            opacity: 0.95;
            font-weight: 400;
            max-width: 700px;
            text-align: center;
        }

        body.interacting h1, body.interacting p.subtitle { display: none !important; }

        /* --- LENSES GRID --- */
        .lenses-grid {
            display: grid;
            grid-template-columns: repeat(3, 1fr);
            gap: 12px;
            width: 100%;
            max-width: 880px; 
            margin-bottom: 20px; 
            justify-content: center;
        }

        body.interacting .lenses-grid {
            display: flex;
            flex-direction: column;
            width: 230px; 
            margin-bottom: 0;
            flex-shrink: 0;
            gap: 10px;
        }

        .lens-card {
            background: rgba(255, 255, 255, 0.15);
            backdrop-filter: blur(8px);
            -webkit-backdrop-filter: blur(8px);
            border: 1px solid rgba(255,255,255,0.3);
            padding: 12px 15px; 
            height: 76px; 
            border-radius: 8px; 
            cursor: pointer;
            text-align: center; 
            transition: all 0.2s ease;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
        }

        .lens-card:hover {
            background: rgba(255, 255, 255, 0.25);
            transform: translateY(-3px);
        }

        .lens-card.active-lens {
            background: rgba(255, 255, 255, 0.35);
            border: 2px solid white;
        }

        .lens-title { 
            font-weight: 500; 
            font-size: 1.15rem; 
            display: block; 
            line-height: 1.15;
            color: white;
        }

        /* --- CHAT CONTAINER --- */
        .chat-container {
            width: 100%; 
            background: transparent; 
            height: 160px; 
            border-radius: 8px; 
            overflow: visible; 
            display: flex;
            flex-direction: column;
            transition: all 0.5s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative; 
        }

        body.interacting .chat-container { 
            flex-grow: 1; 
            height: 96vh; 
            background: #ffffff; 
            box-shadow: 0 10px 30px rgba(0,0,0,0.2);
            overflow: hidden; 
        }

        .chat-header-lintel {
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 60px;
            background: linear-gradient(to bottom, #ffffff 60%, rgba(255, 255, 255, 0) 100%);
            z-index: 45;
            pointer-events: none;
            display: none;
        }
        body.interacting .chat-header-lintel { display: block; }

        /* --- ARTIFACTS PANEL --- */
        .artifacts-panel {
            display: none;
            width: 340px; 
            height: 96vh;
            flex-shrink: 0;
            background: rgba(255, 255, 255, 0.1);
            backdrop-filter: blur(12px);
            -webkit-backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.2);
            border-radius: 12px;
            padding: 20px;
            overflow-y: auto;
            color: white;
        }

        body.interacting .artifacts-panel { display: flex; flex-direction: column; }

        .artifact-header {
            font-size: 14px;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 20px;
            opacity: 0.8;
            font-weight: 600;
            border-bottom: 1px solid rgba(255,255,255,0.2);
            padding-bottom: 10px;
        }

        .artifact-card {
            background: rgba(255, 255, 255, 0.15);
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 12px;
            border: 1px solid rgba(255,255,255,0.1);
        }

        .artifact-card .type { font-size: 10px; font-weight: 700; color: #00D1FF; margin-bottom: 4px; }
        .artifact-card .title { font-size: 14px; font-weight: 500; margin-bottom: 8px; display: block; }
        .artifact-card .meta { font-size: 12px; opacity: 0.7; }

        /* --- CHAT INTERNAL STYLING --- */
        .chat-history {
            flex-grow: 1;
            padding: 60px 30px 180px 30px; 
            overflow-y: auto;
            display: none; 
            background: white; 
        }

        body.interacting .chat-history { display: flex; flex-direction: column; }

        /* --- FIXED WIDTH INPUT PILL (770px) --- */
        .chat-input-area {
            position: absolute;
            bottom: 30px; 
            left: 50%;
            transform: translateX(-50%);
            width: 770px !important; 
            display: flex;
            flex-direction: column; 
            padding: 20px 30px 15px 30px;
            background: #ffffff;
            border: 1px solid rgba(0,0,0,0.08);
            border-radius: 32px; 
            box-shadow: 0 12px 40px rgba(0,0,0,0.15); 
            z-index: 50;
        }

        /* FIXED: Textarea styling for proper scrolling and expansion */
        textarea { 
            background: transparent; 
            border: none; 
            color: #1F1F1F; 
            font-size: 16px; 
            outline: none; 
            resize: none; 
            margin-bottom: 10px;
            max-height: 200px; /* Limits height */
            overflow-y: auto; /* Enables scroll when text exceeds max-height */
            line-height: 1.5;
            display: block;
            width: 100%;
        }

        /* --- MESSAGES & ASSEMBLY --- */
        .msg { margin-bottom: 30px; font-size: 16px; line-height: 1.6; color: #1F1F1F; width: 100%; }
        
        .msg.you { display: flex; flex-direction: column; align-items: flex-end; text-align: right; }
        .msg.you .msg-bubble-container { display: flex; align-items: flex-start; gap: 8px; flex-direction: row-reverse; max-width: 65%; }
        .msg.you .msg-content { background: #F0F4F9; padding: 12px 20px; border-radius: 22px 0px 22px 22px; }
        
        .msg.ats { 
            display: flex; 
            flex-direction: row; 
            align-items: flex-start; 
            text-align: left; 
            gap: 12px; 
            padding-left: 80px; 
            padding-right: 20px; 
        }
        
        .msg-body { display: flex; flex-direction: column; width: 100%; }
        .msg.ats .msg-content { max-width: 100%; background: transparent; padding: 0; }

        /* --- GEMINI ACTION ICONS --- */
        .action-row {
            display: flex;
            align-items: center;
            gap: 2px; 
            margin-top: 14px;
            opacity: 1; 
        }

        .action-btn {
            background: none;
            border: none;
            cursor: pointer;
            color: #444746;
            padding: 4px; 
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: background 0.2s, color 0.2s;
            position: relative;
        }
        .action-btn:hover { background: rgba(0,0,0,0.06); color: #1F1F1F; }
        .action-btn svg { width: 18px; height: 18px; fill: currentColor; transition: color 0.2s; } 

        /* FEEDBACK ACTIVE STATE */
        .action-btn.active-feedback { color: #0079FF !important; }

        /* --- TOOLTIP STYLE (BLACK BOX) --- */
        .tooltip {
            position: absolute;
            bottom: -34px; 
            left: 50%;
            transform: translateX(-50%);
            background-color: #2c2c2c;
            color: #ffffff;
            padding: 6px 10px;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 400;
            white-space: nowrap;
            opacity: 0;
            visibility: hidden;
            transition: opacity 0.2s ease, visibility 0.2s ease;
            z-index: 1000;
            pointer-events: none;
            letter-spacing: 0.2px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.2);
        }

        .action-btn:hover .tooltip {
            opacity: 1;
            visibility: visible;
            transition-delay: 0.1s;
        }
        
        /* --- LISTS & CODE BLOCKS --- */
        .msg-content ul { margin: 12px 0 12px 20px; }
        .msg-content li { margin-bottom: 8px; }
        pre.code-block {
            background: #F8F9FA; border: 1px solid #E3E8EF; border-radius: 8px; padding: 16px;
            margin: 12px 0; font-family: 'Courier New', Courier, monospace; font-size: 14px;
            overflow-x: auto; color: #1F1F1F;
        }
        .code-keyword { color: #d73a49; font-weight: 600; }
        .code-string { color: #032f62; }
        .code-comment { color: #6a737d; font-style: italic; }
        .code-func { color: #6f42c1; }

        /* --- BOT ICON --- */
        .bot-icon { 
            flex-shrink: 0; 
            width: 26px; 
            height: 26px; 
            margin-top: 3px; 
            display: flex; 
            align-items: center; 
            justify-content: center; 
        }
        .bot-icon img { width: 100%; height: 100%; filter: invert(37%) sepia(93%) saturate(3471%) hue-rotate(202deg) brightness(101%) contrast(107%); }

        .typing { display: none; margin-bottom: 20px; padding-left: 80px; align-items: center; gap: 12px; }

        /* --- FOOTER UI & BUTTONS --- */
        .input-footer { display: flex; justify-content: space-between; align-items: center; width: 100%; }
        .footer-left, .footer-right { display: flex; align-items: center; gap: 12px; position: relative; }
        
        .icon-btn { background: none; border: none; cursor: pointer; color: #444746; width: 32px; height: 32px; border-radius: 50%; display: flex; align-items: center; justify-content: center; }
        .icon-btn svg { width: 20px; height: 20px; }
        
        .send-btn-original { background: #D7DDE8; border: none; border-radius: 50%; width: 40px; height: 40px; display: flex; align-items: center; justify-content: center; cursor: pointer; transition: all 0.2s; }
        .send-btn-original svg { width: 24px; height: 24px; fill: #0079FF; margin-left: 2px; }

        .send-btn-original.is-thinking svg { fill: #0079FF; width: 25px; height: 25px; margin-left: 0; }

        /* --- ANIMATIONS --- */
        @keyframes subtleFadeIn { from { opacity: 0; transform: translateY(4px); } to { opacity: 1; transform: translateY(0); } }
        .gemini-fade { animation: subtleFadeIn 0.5s ease forwards; }

        .thinking-wrapper { position: relative; width: 34px; height: 34px; display: flex; align-items: center; justify-content: center; }
        .thinking-ring { position: absolute; width: 100%; height: 100%; border-radius: 50%; border: 2px solid rgba(143, 41, 252, 0.1); border-top-color: #8F29FC; animation: spin 1s linear infinite; }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        .reset-btn { position: absolute; top: 10px; right: 15px; background: none; border: none; cursor: pointer; display: none; z-index: 60; padding: 15px; border-radius: 50%; }
        body.interacting .reset-btn { display: flex; }
    </style>
</head>
<body id="body">

    <div class="video-background">
        <iframe src="https://player.vimeo.com/video/1000239305?background=1&autoplay=1&loop=1&byline=0&title=0&muted=1" frameborder="0"></iframe>
    </div>
    <div class="overlay"></div>

    <nav id="navBar"><div class="nav-brand"><img src="logo.png" alt="Brambles Logo" class="logo-img"></div></nav>

    <div class="container" id="mainContainer">
        <h1>How do you want to work today?</h1>
        <p class="subtitle">Find the right analytics tools, permissions and data.</p>

        <div class="lenses-grid" id="lensesGrid">
            <div class="lens-card" onclick="triggerChat('tool', this)"><span class="lens-title">Find tools & code</span></div>
            <div class="lens-card" onclick="triggerChat('standards', this)"><span class="lens-title">Ways of working</span></div>
            <div class="lens-card" onclick="triggerChat('data', this)"><span class="lens-title">Find your tribe</span></div>
        </div>

        <div class="chat-container" id="chatContainer">
            <div class="chat-header-lintel"></div> 
            <button class="reset-btn" onclick="resetUI()">
                <svg viewBox="0 0 24 24" fill="#1F1F1F" opacity="0.7" width="20" height="20"><path d="M19 6.41L17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
            </button>
            <div class="chat-history" id="chatHistory">
                <div id="typingIndicator" class="typing">
                    <div class="thinking-wrapper">
                        <div class="thinking-ring"></div>
                        <div class="bot-icon"><img src="noun-ai-7305313.png" alt="ATS"></div>
                    </div>
                    <div class="msg-body"><div id="thoughtLabel" class="thought-token" style="font-size:12px;color:#1F1F1F">Thinking...</div></div>
                </div>
            </div>
            
            <div class="chat-input-area">
                <textarea id="chatInput" placeholder="Ask ATS" onkeypress="handleEnter(event)" oninput="autoExpand(this)"></textarea>
                <div class="input-footer">
                    <div class="footer-left">
                        <button class="icon-btn">
                            <svg viewBox="0 0 24 24" fill="none" xmlns="http://www.w3.org/2000/svg"><path d="M12 5V19M5 12H19" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg>
                        </button>
                    </div>
                    <div class="footer-right">
                        <button id="sendBtn" class="send-btn-original" onclick="handleButtonClick()">
                            <svg id="sendIcon" viewBox="0 0 24 24"><path d="M2.01 21L23 12 2.01 3 2 10l15 2-15 2z" fill="#0079FF"></path></svg>
                        </button>
                    </div>
                </div>
            </div>
        </div>

        <div class="artifacts-panel" id="artifactsPanel">
            <div class="artifact-header">Resources & Artifacts</div>
            <div class="artifact-card">
                <div class="type">DOCUMENTATION</div>
                <span class="title">Azure Databricks Setup Guide</span>
                <div class="meta">PDF â€¢ 2.4 MB</div>
            </div>
        </div>
    </div>

    <script>
        const chatHistory = document.getElementById('chatHistory');
        const typingIndicator = document.getElementById('typingIndicator');
        const thoughtLabel = document.getElementById('thoughtLabel');
        const body = document.getElementById('body');
        const chatInput = document.getElementById('chatInput');
        const sendBtn = document.getElementById('sendBtn');
        const sendIcon = document.getElementById('sendIcon');

        const ICONS = {
            copy: `<svg viewBox="0 -960 960 960"><path d="M360-240q-33 0-56.5-23.5T280-320v-480q0-33 23.5-56.5T360-880h360q33 0 56.5 23.5T800-800v480q0-33-23.5-56.5T720-240H360Zm0-80h360v-480H360v480ZM200-80q-33 0-56.5-23.5T120-160v-560h80v560h440v80H200Zm160-240v-480 480Z"/></svg>`,
            redo: `<svg viewBox="0 -960 960 960"><path d="M480-160q-134 0-227-93t-93-227q0-134 93-227t227-93q69 0 132 28.5T720-690v-110h80v280H520v-80h168q-32-56-87.5-88T480-720q-100 0-170 70t-70 170q0 100 70 170t170 70q77 0 139-44t87-116h84q-28 106-114 173t-196 67Z"/></svg>`,
            thumbUp: `<svg viewBox="0 -960 960 960"><path d="M720-120H280v-520l280-280 50 50q7 7 11.5 19t4.5 23v14l-44 174h258q32 0 56 24t24 56v80q0 7-2 15t-4 15L794-188q-9 22-30 45t-44 23Zm-360-80h360l120-280v-80H480l54-220-174 174v406Zm0-406v406-406Zm-80-114v80H160v360h120v80H80v-520h200Z"/></svg>`,
            thumbDown: `<svg viewBox="0 -960 960 960"><path d="M240-840h440v520L400-40l-50-50q-7-7-11.5-19t-4.5-23v-14l44-174H120q-32 0-56-24t-24-56v-80q0-7 2-15t4-15l166-386q9-22 30-45t44-23Zm360 80H240L120-480v80h360l-54 220 174-174v-406Zm0 406v-406 406Zm80 114v-80h120v-360H680v-80h200v520H680Z"/></svg>`,
            thumbUpFilled: `<svg viewBox="0 -960 960 960"><path d="M200-120v-520h160v520H200Zm240 0q-33 0-56.5-23.5T360-200v-393q0-19 8.5-35t23.5-25l168-167 48 48q11 11 15.5 25t4.5 29v14l-44 174h258q33 0 56.5 23.5T920-480v80q0 8-1.5 15t-4.5 15L814-188q-10 24-31 46t-43 22H440Z"/></svg>`,
            thumbDownFilled: `<svg viewBox="0 -960 960 960"><path d="M760-840v520H600v-520h160Zm-240 0q33 0 56.5 23.5T600-760v393q0 19-8.5 35t-23.5 25L400-140l-48-48q-11-11-15.5-25t-4.5-29v-14l44-174H120q-33 0-56.5-23.5T40-480v-80q0-8 1.5-15t4.5-15l100-202q10-24 31-46t43-22h300Z"/></svg>`
        };

        let isThinking = false;
        let lastUserMessage = "";
        const dummyThoughts = ["Scanning stack...", "Checking governance...", "Finalizing..."];

        function handleButtonClick() { if (isThinking) { stopThinking = true; } else { sendUserMessage(); } }

        function copyToClipboard(text, btn) {
            navigator.clipboard.writeText(text).then(() => {
                const originalColor = btn.style.color;
                btn.style.color = '#1a73e8';
                setTimeout(() => btn.style.color = originalColor, 1000);
            });
        }

        function copyText(btn) {
            const container = btn.closest('.msg-body') || btn.closest('.msg-bubble-container');
            const content = container.querySelector('.msg-content').innerText;
            copyToClipboard(content, btn);
        }

        // Handle Mutually Exclusive Thumb Logic with Icon Swapping
        function handleFeedback(btn, type) {
            const row = btn.parentElement;
            const upBtn = row.querySelector('.thumb-up-btn');
            const downBtn = row.querySelector('.thumb-down-btn');

            if (type === 'up') {
                // Deactivate Down
                downBtn.classList.remove('active-feedback');
                downBtn.innerHTML = ICONS.thumbDown + '<span class="tooltip">Bad response</span>';
                
                // Toggle Up
                const isActive = btn.classList.toggle('active-feedback');
                btn.innerHTML = (isActive ? ICONS.thumbUpFilled : ICONS.thumbUp) + '<span class="tooltip">Good response</span>';
            } else {
                // Deactivate Up
                upBtn.classList.remove('active-feedback');
                upBtn.innerHTML = ICONS.thumbUp + '<span class="tooltip">Good response</span>';

                // Toggle Down
                const isActive = btn.classList.toggle('active-feedback');
                btn.innerHTML = (isActive ? ICONS.thumbDownFilled : ICONS.thumbDown) + '<span class="tooltip">Bad response</span>';
            }
        }

        async function simulateThinking(finalText) {
            isThinking = true;
            typingIndicator.style.display = 'flex';
            chatHistory.scrollTop = chatHistory.scrollHeight;
            for (const thought of dummyThoughts) {
                thoughtLabel.innerText = thought;
                await new Promise(r => setTimeout(r, 600));
            }
            addMessage(finalText, 'ATS');
            typingIndicator.style.display = 'none';
            isThinking = false;
        }

        function sendUserMessage(retext = null) {
            body.classList.add('interacting');
            const text = retext || chatInput.value.trim();
            if(!text) return;
            lastUserMessage = text;
            addMessage(text, 'You');
            
            if(!retext) {
                chatInput.value = '';
                chatInput.style.height = 'auto'; 
            }
            
            const response = `Based on your request, I recommend utilizing a standard Azure Databricks cluster:
            <pre class="code-block"><span class="code-keyword">import</span> databricks.koalas <span class="code-keyword">as</span> ks\ndf = ks.<span class="code-func">read_csv</span>(<span class="code-string">"dbfs:/mnt/data.csv"</span>)</pre>
            <ul><li>Scalable compute nodes.</li><li>Shared tribe workspace.</li></ul>`;
            simulateThinking(response);
        }

        function addMessage(text, sender) {
            const div = document.createElement('div');
            div.className = `msg ${sender.toLowerCase()}`;
            
            if (sender === 'ATS') { 
                div.innerHTML = `
                    <div class="bot-icon"><img src="noun-ai-7305313.png" alt="ATS"></div>
                    <div class="msg-body">
                        <div class="msg-content gemini-fade">${text}</div>
                        <div class="action-row">
                            <button class="action-btn thumb-up-btn" onclick="handleFeedback(this, 'up')">${ICONS.thumbUp}<span class="tooltip">Good response</span></button>
                            <button class="action-btn thumb-down-btn" onclick="handleFeedback(this, 'down')">${ICONS.thumbDown}<span class="tooltip">Bad response</span></button>
                            <button class="action-btn" onclick="sendUserMessage(lastUserMessage)">${ICONS.redo}<span class="tooltip">Regenerate</span></button>
                            <button class="action-btn" onclick="copyText(this)">${ICONS.copy}<span class="tooltip">Copy response</span></button>
                        </div>
                    </div>`; 
            } else { 
                div.innerHTML = `
                    <div class="msg-bubble-container">
                        <div class="msg-content">${text}</div>
                        <div class="action-row" style="margin-top:0">
                            <button class="action-btn" onclick="copyText(this)">${ICONS.copy}<span class="tooltip">Copy prompt</span></button>
                        </div>
                    </div>`; 
            }
            chatHistory.insertBefore(div, typingIndicator);
            chatHistory.scrollTop = chatHistory.scrollHeight;
        }

        function triggerChat(lens, element) { 
            body.classList.add('interacting'); 
            addMessage(`Welcome! How can I help with ${lens} today?`, 'ATS'); 
            chatInput.focus();
        }

        function resetUI() { 
            body.classList.remove('interacting'); 
            chatInput.value = '';
            chatInput.style.height = 'auto';
        }
        
        function autoExpand(el) { 
            el.style.height = 'auto'; 
            let newHeight = el.scrollHeight;
            if (newHeight > 200) {
                el.style.height = '200px';
            } else {
                el.style.height = newHeight + 'px';
            }
        }

        function handleEnter(e) { if(e.key === 'Enter' && !e.shiftKey) { e.preventDefault(); sendUserMessage(); } }
    </script>
</body>
</html>